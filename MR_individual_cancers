##individual cancers
####bladder_cancer
outcome_gu<-read_tsv("gwas_data/bladder_cancer.tsv")
outcome_gu$phenotype<- 'bladder_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

bladder_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(bladder_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/bladder_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

bladder_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(bladder_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/bladder_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

bladder_cancer_singlesnp_results_IVW <- filter(bladder_cancer_singlesnp_results, 
                                               SNP=="All - Inverse variance weighted")
bladder_cancer_singlesnp_results_IVW$drug<-"combined"
bladder_cancer_singlesnp_results_Egger <- filter(bladder_cancer_singlesnp_results, 
                                                 SNP=="All - MR Egger")
bladder_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


bladder_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bladder_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

bladder_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bladder_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

bladder_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bladder_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

bladder_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bladder_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

bladder_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bladder_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

bladder_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bladder_cancer_singlesnp_results_Insulins$drug<-"Insulins"


bladder_cancer_singlesnp_results <- rbind(bladder_cancer_singlesnp_results_Egger,
                                          bladder_cancer_singlesnp_results_IVW,
                                          bladder_cancer_singlesnp_results_alpha,
                                          bladder_cancer_singlesnp_results_amylin,
                                          bladder_cancer_singlesnp_results_sulfonylureas,
                                          bladder_cancer_singlesnp_results_biguanides,
                                          bladder_cancer_singlesnp_results_dpp,
                                          bladder_cancer_singlesnp_results_Insulins)

bladder_cancer_singlesnp_results$or<-1/exp(bladder_cancer_singlesnp_results$b)
bladder_cancer_singlesnp_results$uci <- 1/exp(bladder_cancer_singlesnp_results$b-1.96*bladder_cancer_singlesnp_results$se)
bladder_cancer_singlesnp_results$lci <- 1/exp(bladder_cancer_singlesnp_results$b+1.96*bladder_cancer_singlesnp_results$se)


####kidney_cancer
outcome_gu<-read_tsv("gwas_data/kidney_cancer.tsv")
outcome_gu$phenotype<- 'kidney_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

kidney_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(kidney_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/kidney_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

kidney_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(kidney_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/kidney_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

kidney_cancer_singlesnp_results_IVW <- filter(kidney_cancer_singlesnp_results, 
                                              SNP=="All - Inverse variance weighted")
kidney_cancer_singlesnp_results_IVW$drug<-"combined"
kidney_cancer_singlesnp_results_Egger <- filter(kidney_cancer_singlesnp_results, 
                                                SNP=="All - MR Egger")
kidney_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


kidney_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
kidney_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

kidney_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
kidney_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

kidney_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
kidney_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

kidney_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
kidney_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

kidney_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
kidney_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

kidney_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
kidney_cancer_singlesnp_results_Insulins$drug<-"Insulins"


kidney_cancer_singlesnp_results <- rbind(kidney_cancer_singlesnp_results_Egger,
                                         kidney_cancer_singlesnp_results_IVW,
                                         kidney_cancer_singlesnp_results_alpha,
                                         kidney_cancer_singlesnp_results_amylin,
                                         kidney_cancer_singlesnp_results_sulfonylureas,
                                         kidney_cancer_singlesnp_results_biguanides,
                                         kidney_cancer_singlesnp_results_dpp,
                                         kidney_cancer_singlesnp_results_Insulins)

kidney_cancer_singlesnp_results$or<-1/exp(kidney_cancer_singlesnp_results$b)
kidney_cancer_singlesnp_results$uci <- 1/exp(kidney_cancer_singlesnp_results$b-1.96*kidney_cancer_singlesnp_results$se)
kidney_cancer_singlesnp_results$lci <- 1/exp(kidney_cancer_singlesnp_results$b+1.96*kidney_cancer_singlesnp_results$se)


####prostate_cancer
outcome_gu<-read_tsv("gwas_data/prostate_cancer.tsv")
outcome_gu$phenotype<- 'prostate_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

prostate_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(prostate_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/prostate_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

prostate_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(prostate_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/prostate_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

prostate_cancer_singlesnp_results_IVW <- filter(prostate_cancer_singlesnp_results, 
                                                SNP=="All - Inverse variance weighted")
prostate_cancer_singlesnp_results_IVW$drug<-"combined"
prostate_cancer_singlesnp_results_Egger <- filter(prostate_cancer_singlesnp_results, 
                                                  SNP=="All - MR Egger")
prostate_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


prostate_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
prostate_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

prostate_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
prostate_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

prostate_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
prostate_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

prostate_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
prostate_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

prostate_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
prostate_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

prostate_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
prostate_cancer_singlesnp_results_Insulins$drug<-"Insulins"


prostate_cancer_singlesnp_results <- rbind(prostate_cancer_singlesnp_results_Egger,
                                           prostate_cancer_singlesnp_results_IVW,
                                           prostate_cancer_singlesnp_results_alpha,
                                           prostate_cancer_singlesnp_results_amylin,
                                           prostate_cancer_singlesnp_results_sulfonylureas,
                                           prostate_cancer_singlesnp_results_biguanides,
                                           prostate_cancer_singlesnp_results_dpp,
                                           prostate_cancer_singlesnp_results_Insulins)

prostate_cancer_singlesnp_results$or<-1/exp(prostate_cancer_singlesnp_results$b)
prostate_cancer_singlesnp_results$uci <- 1/exp(prostate_cancer_singlesnp_results$b-1.96*prostate_cancer_singlesnp_results$se)
prostate_cancer_singlesnp_results$lci <- 1/exp(prostate_cancer_singlesnp_results$b+1.96*prostate_cancer_singlesnp_results$se)


####testicular_cancer
outcome_gu<-read_tsv("gwas_data/testicular_cancer.tsv")
outcome_gu$phenotype<- 'testicular_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

testicular_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(testicular_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/testicular_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

testicular_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(testicular_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/testicular_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

testicular_cancer_singlesnp_results_IVW <- filter(testicular_cancer_singlesnp_results, 
                                                  SNP=="All - Inverse variance weighted")
testicular_cancer_singlesnp_results_IVW$drug<-"combined"
testicular_cancer_singlesnp_results_Egger <- filter(testicular_cancer_singlesnp_results, 
                                                    SNP=="All - MR Egger")
testicular_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


testicular_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
testicular_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

testicular_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
testicular_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

testicular_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
testicular_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

testicular_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
testicular_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

testicular_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
testicular_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

testicular_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
testicular_cancer_singlesnp_results_Insulins$drug<-"Insulins"


testicular_cancer_singlesnp_results <- rbind(testicular_cancer_singlesnp_results_Egger,
                                             testicular_cancer_singlesnp_results_IVW,
                                             testicular_cancer_singlesnp_results_alpha,
                                             testicular_cancer_singlesnp_results_amylin,
                                             testicular_cancer_singlesnp_results_sulfonylureas,
                                             testicular_cancer_singlesnp_results_biguanides,
                                             testicular_cancer_singlesnp_results_dpp,
                                             testicular_cancer_singlesnp_results_Insulins)

testicular_cancer_singlesnp_results$or<-1/exp(testicular_cancer_singlesnp_results$b)
testicular_cancer_singlesnp_results$uci <- 1/exp(testicular_cancer_singlesnp_results$b-1.96*testicular_cancer_singlesnp_results$se)
testicular_cancer_singlesnp_results$lci <- 1/exp(testicular_cancer_singlesnp_results$b+1.96*testicular_cancer_singlesnp_results$se)


##save data
list_of_datasets2 <- list("bladder_cancer" = bladder_cancer_leaveoneout_results,
                          "kidney_cancer" = kidney_cancer_leaveoneout_results, 
                          "prostate_cancer" = prostate_cancer_leaveoneout_results, 
                          "testicular_cancer" = testicular_cancer_leaveoneout_results)

write.xlsx(list_of_datasets2, file = "mr_output/met-c-859/leaveoneout_urinary_system.xlsx")

list_of_datasets3 <- list("bladder_cancer" = bladder_cancer_singlesnp_results,
                          "kidney_cancer" = kidney_cancer_singlesnp_results, 
                          "prostate_cancer" = prostate_cancer_singlesnp_results, 
                          "testicular_cancer" = testicular_cancer_singlesnp_results)
write.xlsx(list_of_datasets3, file = "mr_output/met-c-859/singlesnp_urinary_system.xlsx")

####cervix_uteri_cancer
outcome_gu<-read_tsv("gwas_data/cervix_uteri_cancer.tsv")
outcome_gu$phenotype<- 'cervix_uteri_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

cervix_uteri_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(cervix_uteri_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/cervix_uteri_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

cervix_uteri_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(cervix_uteri_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/cervix_uteri_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

cervix_uteri_cancer_singlesnp_results_IVW <- filter(cervix_uteri_cancer_singlesnp_results, 
                                                    SNP=="All - Inverse variance weighted")
cervix_uteri_cancer_singlesnp_results_IVW$drug<-"combined"
cervix_uteri_cancer_singlesnp_results_Egger <- filter(cervix_uteri_cancer_singlesnp_results, 
                                                      SNP=="All - MR Egger")
cervix_uteri_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


cervix_uteri_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
cervix_uteri_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

cervix_uteri_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
cervix_uteri_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

cervix_uteri_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
cervix_uteri_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

cervix_uteri_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
cervix_uteri_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

cervix_uteri_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
cervix_uteri_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

cervix_uteri_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
cervix_uteri_cancer_singlesnp_results_Insulins$drug<-"Insulins"


cervix_uteri_cancer_singlesnp_results <- rbind(cervix_uteri_cancer_singlesnp_results_Egger,
                                               cervix_uteri_cancer_singlesnp_results_IVW,
                                               cervix_uteri_cancer_singlesnp_results_alpha,
                                               cervix_uteri_cancer_singlesnp_results_amylin,
                                               cervix_uteri_cancer_singlesnp_results_sulfonylureas,
                                               cervix_uteri_cancer_singlesnp_results_biguanides,
                                               cervix_uteri_cancer_singlesnp_results_dpp,
                                               cervix_uteri_cancer_singlesnp_results_Insulins)

cervix_uteri_cancer_singlesnp_results$or<-1/exp(cervix_uteri_cancer_singlesnp_results$b)
cervix_uteri_cancer_singlesnp_results$uci <- 1/exp(cervix_uteri_cancer_singlesnp_results$b-1.96*cervix_uteri_cancer_singlesnp_results$se)
cervix_uteri_cancer_singlesnp_results$lci <- 1/exp(cervix_uteri_cancer_singlesnp_results$b+1.96*cervix_uteri_cancer_singlesnp_results$se)


####ovarian_cancer
outcome_gu<-read_tsv("gwas_data/ovarian_cancer.tsv")
outcome_gu$phenotype<- 'ovarian_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

ovarian_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(ovarian_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/ovarian_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

ovarian_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(ovarian_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/ovarian_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

ovarian_cancer_singlesnp_results_IVW <- filter(ovarian_cancer_singlesnp_results, 
                                               SNP=="All - Inverse variance weighted")
ovarian_cancer_singlesnp_results_IVW$drug<-"combined"
ovarian_cancer_singlesnp_results_Egger <- filter(ovarian_cancer_singlesnp_results, 
                                                 SNP=="All - MR Egger")
ovarian_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


ovarian_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
ovarian_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

ovarian_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
ovarian_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

ovarian_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
ovarian_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

ovarian_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
ovarian_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

ovarian_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
ovarian_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

ovarian_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
ovarian_cancer_singlesnp_results_Insulins$drug<-"Insulins"


ovarian_cancer_singlesnp_results <- rbind(ovarian_cancer_singlesnp_results_Egger,
                                          ovarian_cancer_singlesnp_results_IVW,
                                          ovarian_cancer_singlesnp_results_alpha,
                                          ovarian_cancer_singlesnp_results_amylin,
                                          ovarian_cancer_singlesnp_results_sulfonylureas,
                                          ovarian_cancer_singlesnp_results_biguanides,
                                          ovarian_cancer_singlesnp_results_dpp,
                                          ovarian_cancer_singlesnp_results_Insulins)

ovarian_cancer_singlesnp_results$or<-1/exp(ovarian_cancer_singlesnp_results$b)
ovarian_cancer_singlesnp_results$uci <- 1/exp(ovarian_cancer_singlesnp_results$b-1.96*ovarian_cancer_singlesnp_results$se)
ovarian_cancer_singlesnp_results$lci <- 1/exp(ovarian_cancer_singlesnp_results$b+1.96*ovarian_cancer_singlesnp_results$se)


####vulvar_cancer
outcome_gu<-read_tsv("gwas_data/vulvar_cancer.tsv")
outcome_gu$phenotype<- 'vulvar_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

vulvar_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(vulvar_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/vulvar_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

vulvar_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(vulvar_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/vulvar_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

vulvar_cancer_singlesnp_results_IVW <- filter(vulvar_cancer_singlesnp_results, 
                                              SNP=="All - Inverse variance weighted")
vulvar_cancer_singlesnp_results_IVW$drug<-"combined"
vulvar_cancer_singlesnp_results_Egger <- filter(vulvar_cancer_singlesnp_results, 
                                                SNP=="All - MR Egger")
vulvar_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


vulvar_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
vulvar_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

vulvar_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
vulvar_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

vulvar_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
vulvar_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

vulvar_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
vulvar_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

vulvar_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
vulvar_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

vulvar_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
vulvar_cancer_singlesnp_results_Insulins$drug<-"Insulins"


vulvar_cancer_singlesnp_results <- rbind(vulvar_cancer_singlesnp_results_Egger,
                                         vulvar_cancer_singlesnp_results_IVW,
                                         vulvar_cancer_singlesnp_results_alpha,
                                         vulvar_cancer_singlesnp_results_amylin,
                                         vulvar_cancer_singlesnp_results_sulfonylureas,
                                         vulvar_cancer_singlesnp_results_biguanides,
                                         vulvar_cancer_singlesnp_results_dpp,
                                         vulvar_cancer_singlesnp_results_Insulins)

vulvar_cancer_singlesnp_results$or<-1/exp(vulvar_cancer_singlesnp_results$b)
vulvar_cancer_singlesnp_results$uci <- 1/exp(vulvar_cancer_singlesnp_results$b-1.96*vulvar_cancer_singlesnp_results$se)
vulvar_cancer_singlesnp_results$lci <- 1/exp(vulvar_cancer_singlesnp_results$b+1.96*vulvar_cancer_singlesnp_results$se)


####endometrial_cancer
outcome_gu<-read_tsv("gwas_data/endometrial_cancer.tsv")
outcome_gu$phenotype<- 'endometrial_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

endometrial_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(endometrial_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/endometrial_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

endometrial_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(endometrial_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/endometrial_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

endometrial_cancer_singlesnp_results_IVW <- filter(endometrial_cancer_singlesnp_results, 
                                                   SNP=="All - Inverse variance weighted")
endometrial_cancer_singlesnp_results_IVW$drug<-"combined"
endometrial_cancer_singlesnp_results_Egger <- filter(endometrial_cancer_singlesnp_results, 
                                                     SNP=="All - MR Egger")
endometrial_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


endometrial_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
endometrial_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

endometrial_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
endometrial_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

endometrial_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
endometrial_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

endometrial_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
endometrial_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

endometrial_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
endometrial_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

endometrial_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
endometrial_cancer_singlesnp_results_Insulins$drug<-"Insulins"


endometrial_cancer_singlesnp_results <- rbind(endometrial_cancer_singlesnp_results_Egger,
                                              endometrial_cancer_singlesnp_results_IVW,
                                              endometrial_cancer_singlesnp_results_alpha,
                                              endometrial_cancer_singlesnp_results_amylin,
                                              endometrial_cancer_singlesnp_results_sulfonylureas,
                                              endometrial_cancer_singlesnp_results_biguanides,
                                              endometrial_cancer_singlesnp_results_dpp,
                                              endometrial_cancer_singlesnp_results_Insulins)

endometrial_cancer_singlesnp_results$or<-1/exp(endometrial_cancer_singlesnp_results$b)
endometrial_cancer_singlesnp_results$uci <- 1/exp(endometrial_cancer_singlesnp_results$b-1.96*endometrial_cancer_singlesnp_results$se)
endometrial_cancer_singlesnp_results$lci <- 1/exp(endometrial_cancer_singlesnp_results$b+1.96*endometrial_cancer_singlesnp_results$se)


list_of_datasets2 <- list("cervix_uteri_cancer" = cervix_uteri_cancer_leaveoneout_results,
                          "ovarian_cancer" = ovarian_cancer_leaveoneout_results, 
                          "vulvar_cancer" = vulvar_cancer_leaveoneout_results, 
                          "endometrial_cancer" = endometrial_cancer_leaveoneout_results)

write.xlsx(list_of_datasets2, file = "mr_output/met-c-859/leaveoneout_gynecologic_system.xlsx")

list_of_datasets3 <- list("cervix_uteri_cancer" = cervix_uteri_cancer_singlesnp_results,
                          "ovarian_cancer" = ovarian_cancer_singlesnp_results, 
                          "vulvar_cancer" = vulvar_cancer_singlesnp_results, 
                          "endometrial_cancer" = endometrial_cancer_singlesnp_results)

write.xlsx(list_of_datasets3, file = "mr_output/met-c-859/singlesnp_gynecologic_system.xlsx")


####laryngeal_cancer
outcome_gu<-read_tsv("gwas_data/laryngeal_cancer.tsv")
outcome_gu$phenotype<- 'laryngeal_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

laryngeal_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(laryngeal_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/laryngeal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

laryngeal_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(laryngeal_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/laryngeal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

laryngeal_cancer_singlesnp_results_IVW <- filter(laryngeal_cancer_singlesnp_results, 
                                                 SNP=="All - Inverse variance weighted")
laryngeal_cancer_singlesnp_results_IVW$drug<-"combined"
laryngeal_cancer_singlesnp_results_Egger <- filter(laryngeal_cancer_singlesnp_results, 
                                                   SNP=="All - MR Egger")
laryngeal_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


laryngeal_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
laryngeal_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

laryngeal_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
laryngeal_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

laryngeal_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
laryngeal_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

laryngeal_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
laryngeal_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

laryngeal_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
laryngeal_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

laryngeal_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
laryngeal_cancer_singlesnp_results_Insulins$drug<-"Insulins"


laryngeal_cancer_singlesnp_results <- rbind(laryngeal_cancer_singlesnp_results_Egger,
                                            laryngeal_cancer_singlesnp_results_IVW,
                                            laryngeal_cancer_singlesnp_results_alpha,
                                            laryngeal_cancer_singlesnp_results_amylin,
                                            laryngeal_cancer_singlesnp_results_sulfonylureas,
                                            laryngeal_cancer_singlesnp_results_biguanides,
                                            laryngeal_cancer_singlesnp_results_dpp,
                                            laryngeal_cancer_singlesnp_results_Insulins)

laryngeal_cancer_singlesnp_results$or<-1/exp(laryngeal_cancer_singlesnp_results$b)
laryngeal_cancer_singlesnp_results$uci <- 1/exp(laryngeal_cancer_singlesnp_results$b-1.96*laryngeal_cancer_singlesnp_results$se)
laryngeal_cancer_singlesnp_results$lci <- 1/exp(laryngeal_cancer_singlesnp_results$b+1.96*laryngeal_cancer_singlesnp_results$se)


####oral_cavity_cancer
outcome_gu<-read_tsv("gwas_data/oral_cavity_cancer.tsv")
outcome_gu$phenotype<- 'oral_cavity_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

oral_cavity_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(oral_cavity_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/oral_cavity_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

oral_cavity_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(oral_cavity_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/oral_cavity_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

oral_cavity_cancer_singlesnp_results_IVW <- filter(oral_cavity_cancer_singlesnp_results, 
                                                   SNP=="All - Inverse variance weighted")
oral_cavity_cancer_singlesnp_results_IVW$drug<-"combined"
oral_cavity_cancer_singlesnp_results_Egger <- filter(oral_cavity_cancer_singlesnp_results, 
                                                     SNP=="All - MR Egger")
oral_cavity_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


oral_cavity_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oral_cavity_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

oral_cavity_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oral_cavity_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

oral_cavity_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oral_cavity_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

oral_cavity_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oral_cavity_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

oral_cavity_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oral_cavity_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

oral_cavity_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oral_cavity_cancer_singlesnp_results_Insulins$drug<-"Insulins"


oral_cavity_cancer_singlesnp_results <- rbind(oral_cavity_cancer_singlesnp_results_Egger,
                                              oral_cavity_cancer_singlesnp_results_IVW,
                                              oral_cavity_cancer_singlesnp_results_alpha,
                                              oral_cavity_cancer_singlesnp_results_amylin,
                                              oral_cavity_cancer_singlesnp_results_sulfonylureas,
                                              oral_cavity_cancer_singlesnp_results_biguanides,
                                              oral_cavity_cancer_singlesnp_results_dpp,
                                              oral_cavity_cancer_singlesnp_results_Insulins)

oral_cavity_cancer_singlesnp_results$or<-1/exp(oral_cavity_cancer_singlesnp_results$b)
oral_cavity_cancer_singlesnp_results$uci <- 1/exp(oral_cavity_cancer_singlesnp_results$b-1.96*oral_cavity_cancer_singlesnp_results$se)
oral_cavity_cancer_singlesnp_results$lci <- 1/exp(oral_cavity_cancer_singlesnp_results$b+1.96*oral_cavity_cancer_singlesnp_results$se)


####oropharyngeal_cancer
outcome_gu<-read_tsv("gwas_data/oropharyngeal_cancer.tsv")
outcome_gu$phenotype<- 'oropharyngeal_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

oropharyngeal_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(oropharyngeal_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/oropharyngeal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

oropharyngeal_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(oropharyngeal_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/oropharyngeal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

oropharyngeal_cancer_singlesnp_results_IVW <- filter(oropharyngeal_cancer_singlesnp_results, 
                                                     SNP=="All - Inverse variance weighted")
oropharyngeal_cancer_singlesnp_results_IVW$drug<-"combined"
oropharyngeal_cancer_singlesnp_results_Egger <- filter(oropharyngeal_cancer_singlesnp_results, 
                                                       SNP=="All - MR Egger")
oropharyngeal_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


oropharyngeal_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oropharyngeal_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

oropharyngeal_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oropharyngeal_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

oropharyngeal_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oropharyngeal_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

oropharyngeal_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oropharyngeal_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

oropharyngeal_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oropharyngeal_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

oropharyngeal_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
oropharyngeal_cancer_singlesnp_results_Insulins$drug<-"Insulins"


oropharyngeal_cancer_singlesnp_results <- rbind(oropharyngeal_cancer_singlesnp_results_Egger,
                                                oropharyngeal_cancer_singlesnp_results_IVW,
                                                oropharyngeal_cancer_singlesnp_results_alpha,
                                                oropharyngeal_cancer_singlesnp_results_amylin,
                                                oropharyngeal_cancer_singlesnp_results_sulfonylureas,
                                                oropharyngeal_cancer_singlesnp_results_biguanides,
                                                oropharyngeal_cancer_singlesnp_results_dpp,
                                                oropharyngeal_cancer_singlesnp_results_Insulins)

oropharyngeal_cancer_singlesnp_results$or<-1/exp(oropharyngeal_cancer_singlesnp_results$b)
oropharyngeal_cancer_singlesnp_results$uci <- 1/exp(oropharyngeal_cancer_singlesnp_results$b-1.96*oropharyngeal_cancer_singlesnp_results$se)
oropharyngeal_cancer_singlesnp_results$lci <- 1/exp(oropharyngeal_cancer_singlesnp_results$b+1.96*oropharyngeal_cancer_singlesnp_results$se)


####salivary_gland_carcinoma
outcome_gu<-read_tsv("gwas_data/salivary_gland_carcinoma.tsv")
outcome_gu$phenotype<- 'salivary_gland_carcinoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

salivary_gland_carcinoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(salivary_gland_carcinoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/salivary_gland_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

salivary_gland_carcinoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(salivary_gland_carcinoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/salivary_gland_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

salivary_gland_carcinoma_singlesnp_results_IVW <- filter(salivary_gland_carcinoma_singlesnp_results, 
                                                         SNP=="All - Inverse variance weighted")
salivary_gland_carcinoma_singlesnp_results_IVW$drug<-"combined"
salivary_gland_carcinoma_singlesnp_results_Egger <- filter(salivary_gland_carcinoma_singlesnp_results, 
                                                           SNP=="All - MR Egger")
salivary_gland_carcinoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


salivary_gland_carcinoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
salivary_gland_carcinoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

salivary_gland_carcinoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
salivary_gland_carcinoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

salivary_gland_carcinoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
salivary_gland_carcinoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

salivary_gland_carcinoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
salivary_gland_carcinoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

salivary_gland_carcinoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
salivary_gland_carcinoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

salivary_gland_carcinoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
salivary_gland_carcinoma_singlesnp_results_Insulins$drug<-"Insulins"


salivary_gland_carcinoma_singlesnp_results <- rbind(salivary_gland_carcinoma_singlesnp_results_Egger,
                                                    salivary_gland_carcinoma_singlesnp_results_IVW,
                                                    salivary_gland_carcinoma_singlesnp_results_alpha,
                                                    salivary_gland_carcinoma_singlesnp_results_amylin,
                                                    salivary_gland_carcinoma_singlesnp_results_sulfonylureas,
                                                    salivary_gland_carcinoma_singlesnp_results_biguanides,
                                                    salivary_gland_carcinoma_singlesnp_results_dpp,
                                                    salivary_gland_carcinoma_singlesnp_results_Insulins)

salivary_gland_carcinoma_singlesnp_results$or<-1/exp(salivary_gland_carcinoma_singlesnp_results$b)
salivary_gland_carcinoma_singlesnp_results$uci <- 1/exp(salivary_gland_carcinoma_singlesnp_results$b-1.96*salivary_gland_carcinoma_singlesnp_results$se)
salivary_gland_carcinoma_singlesnp_results$lci <- 1/exp(salivary_gland_carcinoma_singlesnp_results$b+1.96*salivary_gland_carcinoma_singlesnp_results$se)


####tongue_cancer
outcome_gu<-read_tsv("gwas_data/tougue_cancer.tsv")
outcome_gu$phenotype<- 'tongue_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

tongue_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(tongue_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/tongue_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

tongue_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(tongue_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/tongue_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

tongue_cancer_singlesnp_results_IVW <- filter(tongue_cancer_singlesnp_results, 
                                              SNP=="All - Inverse variance weighted")
tongue_cancer_singlesnp_results_IVW$drug<-"combined"
tongue_cancer_singlesnp_results_Egger <- filter(tongue_cancer_singlesnp_results, 
                                                SNP=="All - MR Egger")
tongue_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


tongue_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
tongue_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

tongue_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
tongue_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

tongue_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
tongue_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

tongue_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
tongue_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

tongue_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
tongue_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

tongue_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
tongue_cancer_singlesnp_results_Insulins$drug<-"Insulins"


tongue_cancer_singlesnp_results <- rbind(tongue_cancer_singlesnp_results_Egger,
                                         tongue_cancer_singlesnp_results_IVW,
                                         tongue_cancer_singlesnp_results_alpha,
                                         tongue_cancer_singlesnp_results_amylin,
                                         tongue_cancer_singlesnp_results_sulfonylureas,
                                         tongue_cancer_singlesnp_results_biguanides,
                                         tongue_cancer_singlesnp_results_dpp,
                                         tongue_cancer_singlesnp_results_Insulins)

tongue_cancer_singlesnp_results$or<-1/exp(tongue_cancer_singlesnp_results$b)
tongue_cancer_singlesnp_results$uci <- 1/exp(tongue_cancer_singlesnp_results$b-1.96*tongue_cancer_singlesnp_results$se)
tongue_cancer_singlesnp_results$lci <- 1/exp(tongue_cancer_singlesnp_results$b+1.96*tongue_cancer_singlesnp_results$se)


list_of_datasets2 <- list("laryngeal_cancer" = laryngeal_cancer_leaveoneout_results,
                          "oral_cavity_cancer" = oral_cavity_cancer_leaveoneout_results, 
                          "oropharyngeal_cancer" = oropharyngeal_cancer_leaveoneout_results, 
                          "salivary_gland_carcinoma" = salivary_gland_carcinoma_leaveoneout_results, 
                          "tongue_cancer" = tongue_cancer_leaveoneout_results)

write.xlsx(list_of_datasets2, file = "mr_output/met-c-859/leaveoneout_head_and_neck_system.xlsx")

list_of_datasets3 <- list("laryngeal_cancer" = laryngeal_cancer_singlesnp_results,
                          "oral_cavity_cancer" = oral_cavity_cancer_singlesnp_results, 
                          "oropharyngeal_cancer" = oropharyngeal_cancer_singlesnp_results, 
                          "salivary_gland_carcinoma" = salivary_gland_carcinoma_singlesnp_results, 
                          "tongue_cancer" = tongue_cancer_singlesnp_results)

write.xlsx(list_of_datasets3, file = "mr_output/met-c-859/singlesnp_head_and_neck_system.xlsx")



####acute_myeloid_leukemia
outcome_gu<-read_tsv("gwas_data/acute_myeloid_leukemia.tsv")
outcome_gu$phenotype<- 'acute_myeloid_leukemia'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

acute_myeloid_leukemia_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(acute_myeloid_leukemia_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/acute_myeloid_leukemia.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

acute_myeloid_leukemia_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(acute_myeloid_leukemia_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/acute_myeloid_leukemia.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

acute_myeloid_leukemia_singlesnp_results_IVW <- filter(acute_myeloid_leukemia_singlesnp_results, 
                                                       SNP=="All - Inverse variance weighted")
acute_myeloid_leukemia_singlesnp_results_IVW$drug<-"combined"
acute_myeloid_leukemia_singlesnp_results_Egger <- filter(acute_myeloid_leukemia_singlesnp_results, 
                                                         SNP=="All - MR Egger")
acute_myeloid_leukemia_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


acute_myeloid_leukemia_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
acute_myeloid_leukemia_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

acute_myeloid_leukemia_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
acute_myeloid_leukemia_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

acute_myeloid_leukemia_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
acute_myeloid_leukemia_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

acute_myeloid_leukemia_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
acute_myeloid_leukemia_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

acute_myeloid_leukemia_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
acute_myeloid_leukemia_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

acute_myeloid_leukemia_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
acute_myeloid_leukemia_singlesnp_results_Insulins$drug<-"Insulins"


acute_myeloid_leukemia_singlesnp_results <- rbind(acute_myeloid_leukemia_singlesnp_results_Egger,
                                                  acute_myeloid_leukemia_singlesnp_results_IVW,
                                                  acute_myeloid_leukemia_singlesnp_results_alpha,
                                                  acute_myeloid_leukemia_singlesnp_results_amylin,
                                                  acute_myeloid_leukemia_singlesnp_results_sulfonylureas,
                                                  acute_myeloid_leukemia_singlesnp_results_biguanides,
                                                  acute_myeloid_leukemia_singlesnp_results_dpp,
                                                  acute_myeloid_leukemia_singlesnp_results_Insulins)

acute_myeloid_leukemia_singlesnp_results$or<-1/exp(acute_myeloid_leukemia_singlesnp_results$b)
acute_myeloid_leukemia_singlesnp_results$uci <- 1/exp(acute_myeloid_leukemia_singlesnp_results$b-1.96*acute_myeloid_leukemia_singlesnp_results$se)
acute_myeloid_leukemia_singlesnp_results$lci <- 1/exp(acute_myeloid_leukemia_singlesnp_results$b+1.96*acute_myeloid_leukemia_singlesnp_results$se)


####chronic_lymphocytic_leukemia
outcome_gu<-read_tsv("gwas_data/chronic_lymphocytic_leukemia.tsv")
outcome_gu$phenotype<- 'chronic_lymphocytic_leukemia'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

chronic_lymphocytic_leukemia_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(chronic_lymphocytic_leukemia_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/chronic_lymphocytic_leukemia.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

chronic_lymphocytic_leukemia_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(chronic_lymphocytic_leukemia_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/chronic_lymphocytic_leukemia.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

chronic_lymphocytic_leukemia_singlesnp_results_IVW <- filter(chronic_lymphocytic_leukemia_singlesnp_results, 
                                                             SNP=="All - Inverse variance weighted")
chronic_lymphocytic_leukemia_singlesnp_results_IVW$drug<-"combined"
chronic_lymphocytic_leukemia_singlesnp_results_Egger <- filter(chronic_lymphocytic_leukemia_singlesnp_results, 
                                                               SNP=="All - MR Egger")
chronic_lymphocytic_leukemia_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


chronic_lymphocytic_leukemia_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_lymphocytic_leukemia_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

chronic_lymphocytic_leukemia_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_lymphocytic_leukemia_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

chronic_lymphocytic_leukemia_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_lymphocytic_leukemia_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

chronic_lymphocytic_leukemia_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_lymphocytic_leukemia_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

chronic_lymphocytic_leukemia_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_lymphocytic_leukemia_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

chronic_lymphocytic_leukemia_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_lymphocytic_leukemia_singlesnp_results_Insulins$drug<-"Insulins"


chronic_lymphocytic_leukemia_singlesnp_results <- rbind(chronic_lymphocytic_leukemia_singlesnp_results_Egger,
                                                        chronic_lymphocytic_leukemia_singlesnp_results_IVW,
                                                        chronic_lymphocytic_leukemia_singlesnp_results_alpha,
                                                        chronic_lymphocytic_leukemia_singlesnp_results_amylin,
                                                        chronic_lymphocytic_leukemia_singlesnp_results_sulfonylureas,
                                                        chronic_lymphocytic_leukemia_singlesnp_results_biguanides,
                                                        chronic_lymphocytic_leukemia_singlesnp_results_dpp,
                                                        chronic_lymphocytic_leukemia_singlesnp_results_Insulins)

chronic_lymphocytic_leukemia_singlesnp_results$or<-1/exp(chronic_lymphocytic_leukemia_singlesnp_results$b)
chronic_lymphocytic_leukemia_singlesnp_results$uci <- 1/exp(chronic_lymphocytic_leukemia_singlesnp_results$b-1.96*chronic_lymphocytic_leukemia_singlesnp_results$se)
chronic_lymphocytic_leukemia_singlesnp_results$lci <- 1/exp(chronic_lymphocytic_leukemia_singlesnp_results$b+1.96*chronic_lymphocytic_leukemia_singlesnp_results$se)


####chronic_myelogenous_leukemia
outcome_gu<-read_tsv("gwas_data/chronic_myelogenous_leukemia.tsv")
outcome_gu$phenotype<- 'chronic_myelogenous_leukemia'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

chronic_myelogenous_leukemia_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(chronic_myelogenous_leukemia_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/chronic_myelogenous_leukemia.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

chronic_myelogenous_leukemia_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(chronic_myelogenous_leukemia_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/chronic_myelogenous_leukemia.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

chronic_myelogenous_leukemia_singlesnp_results_IVW <- filter(chronic_myelogenous_leukemia_singlesnp_results, 
                                                             SNP=="All - Inverse variance weighted")
chronic_myelogenous_leukemia_singlesnp_results_IVW$drug<-"combined"
chronic_myelogenous_leukemia_singlesnp_results_Egger <- filter(chronic_myelogenous_leukemia_singlesnp_results, 
                                                               SNP=="All - MR Egger")
chronic_myelogenous_leukemia_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


chronic_myelogenous_leukemia_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_myelogenous_leukemia_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

chronic_myelogenous_leukemia_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_myelogenous_leukemia_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

chronic_myelogenous_leukemia_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_myelogenous_leukemia_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

chronic_myelogenous_leukemia_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_myelogenous_leukemia_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

chronic_myelogenous_leukemia_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_myelogenous_leukemia_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

chronic_myelogenous_leukemia_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
chronic_myelogenous_leukemia_singlesnp_results_Insulins$drug<-"Insulins"


chronic_myelogenous_leukemia_singlesnp_results <- rbind(chronic_myelogenous_leukemia_singlesnp_results_Egger,
                                                        chronic_myelogenous_leukemia_singlesnp_results_IVW,
                                                        chronic_myelogenous_leukemia_singlesnp_results_alpha,
                                                        chronic_myelogenous_leukemia_singlesnp_results_amylin,
                                                        chronic_myelogenous_leukemia_singlesnp_results_sulfonylureas,
                                                        chronic_myelogenous_leukemia_singlesnp_results_biguanides,
                                                        chronic_myelogenous_leukemia_singlesnp_results_dpp,
                                                        chronic_myelogenous_leukemia_singlesnp_results_Insulins)

chronic_myelogenous_leukemia_singlesnp_results$or<-1/exp(chronic_myelogenous_leukemia_singlesnp_results$b)
chronic_myelogenous_leukemia_singlesnp_results$uci <- 1/exp(chronic_myelogenous_leukemia_singlesnp_results$b-1.96*chronic_myelogenous_leukemia_singlesnp_results$se)
chronic_myelogenous_leukemia_singlesnp_results$lci <- 1/exp(chronic_myelogenous_leukemia_singlesnp_results$b+1.96*chronic_myelogenous_leukemia_singlesnp_results$se)


####hodgkin_lymphoma
outcome_gu<-read_tsv("gwas_data/hodgkin_lymphoma.tsv")
outcome_gu$phenotype<- 'hodgkin_lymphoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

hodgkin_lymphoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(hodgkin_lymphoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/hodgkin_lymphoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

hodgkin_lymphoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(hodgkin_lymphoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/hodgkin_lymphoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

hodgkin_lymphoma_singlesnp_results_IVW <- filter(hodgkin_lymphoma_singlesnp_results, 
                                                 SNP=="All - Inverse variance weighted")
hodgkin_lymphoma_singlesnp_results_IVW$drug<-"combined"
hodgkin_lymphoma_singlesnp_results_Egger <- filter(hodgkin_lymphoma_singlesnp_results, 
                                                   SNP=="All - MR Egger")
hodgkin_lymphoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


hodgkin_lymphoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
hodgkin_lymphoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

hodgkin_lymphoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
hodgkin_lymphoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

hodgkin_lymphoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
hodgkin_lymphoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

hodgkin_lymphoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
hodgkin_lymphoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

hodgkin_lymphoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
hodgkin_lymphoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

hodgkin_lymphoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
hodgkin_lymphoma_singlesnp_results_Insulins$drug<-"Insulins"


hodgkin_lymphoma_singlesnp_results <- rbind(hodgkin_lymphoma_singlesnp_results_Egger,
                                            hodgkin_lymphoma_singlesnp_results_IVW,
                                            hodgkin_lymphoma_singlesnp_results_alpha,
                                            hodgkin_lymphoma_singlesnp_results_amylin,
                                            hodgkin_lymphoma_singlesnp_results_sulfonylureas,
                                            hodgkin_lymphoma_singlesnp_results_biguanides,
                                            hodgkin_lymphoma_singlesnp_results_dpp,
                                            hodgkin_lymphoma_singlesnp_results_Insulins)

hodgkin_lymphoma_singlesnp_results$or<-1/exp(hodgkin_lymphoma_singlesnp_results$b)
hodgkin_lymphoma_singlesnp_results$uci <- 1/exp(hodgkin_lymphoma_singlesnp_results$b-1.96*hodgkin_lymphoma_singlesnp_results$se)
hodgkin_lymphoma_singlesnp_results$lci <- 1/exp(hodgkin_lymphoma_singlesnp_results$b+1.96*hodgkin_lymphoma_singlesnp_results$se)


####non_hodgkin_lymphoma
outcome_gu<-read_tsv("gwas_data/non_hodgkin_lymphoma.tsv")
outcome_gu$phenotype<- 'non_hodgkin_lymphoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

non_hodgkin_lymphoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(non_hodgkin_lymphoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/non_hodgkin_lymphoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

non_hodgkin_lymphoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(non_hodgkin_lymphoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/non_hodgkin_lymphoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

non_hodgkin_lymphoma_singlesnp_results_IVW <- filter(non_hodgkin_lymphoma_singlesnp_results, 
                                                     SNP=="All - Inverse variance weighted")
non_hodgkin_lymphoma_singlesnp_results_IVW$drug<-"combined"
non_hodgkin_lymphoma_singlesnp_results_Egger <- filter(non_hodgkin_lymphoma_singlesnp_results, 
                                                       SNP=="All - MR Egger")
non_hodgkin_lymphoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


non_hodgkin_lymphoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
non_hodgkin_lymphoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

non_hodgkin_lymphoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
non_hodgkin_lymphoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

non_hodgkin_lymphoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
non_hodgkin_lymphoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

non_hodgkin_lymphoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
non_hodgkin_lymphoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

non_hodgkin_lymphoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
non_hodgkin_lymphoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

non_hodgkin_lymphoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
non_hodgkin_lymphoma_singlesnp_results_Insulins$drug<-"Insulins"


non_hodgkin_lymphoma_singlesnp_results <- rbind(non_hodgkin_lymphoma_singlesnp_results_Egger,
                                                non_hodgkin_lymphoma_singlesnp_results_IVW,
                                                non_hodgkin_lymphoma_singlesnp_results_alpha,
                                                non_hodgkin_lymphoma_singlesnp_results_amylin,
                                                non_hodgkin_lymphoma_singlesnp_results_sulfonylureas,
                                                non_hodgkin_lymphoma_singlesnp_results_biguanides,
                                                non_hodgkin_lymphoma_singlesnp_results_dpp,
                                                non_hodgkin_lymphoma_singlesnp_results_Insulins)

non_hodgkin_lymphoma_singlesnp_results$or<-1/exp(non_hodgkin_lymphoma_singlesnp_results$b)
non_hodgkin_lymphoma_singlesnp_results$uci <- 1/exp(non_hodgkin_lymphoma_singlesnp_results$b-1.96*non_hodgkin_lymphoma_singlesnp_results$se)
non_hodgkin_lymphoma_singlesnp_results$lci <- 1/exp(non_hodgkin_lymphoma_singlesnp_results$b+1.96*non_hodgkin_lymphoma_singlesnp_results$se)


####multiple_myeloma
outcome_gu<-read_tsv("gwas_data/multiple_myeloma.tsv")
outcome_gu$phenotype<- 'multiple_myeloma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

multiple_myeloma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(multiple_myeloma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/multiple_myeloma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

multiple_myeloma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(multiple_myeloma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/multiple_myeloma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

multiple_myeloma_singlesnp_results_IVW <- filter(multiple_myeloma_singlesnp_results, 
                                                 SNP=="All - Inverse variance weighted")
multiple_myeloma_singlesnp_results_IVW$drug<-"combined"
multiple_myeloma_singlesnp_results_Egger <- filter(multiple_myeloma_singlesnp_results, 
                                                   SNP=="All - MR Egger")
multiple_myeloma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


multiple_myeloma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
multiple_myeloma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

multiple_myeloma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
multiple_myeloma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

multiple_myeloma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
multiple_myeloma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

multiple_myeloma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
multiple_myeloma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

multiple_myeloma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
multiple_myeloma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

multiple_myeloma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
multiple_myeloma_singlesnp_results_Insulins$drug<-"Insulins"


multiple_myeloma_singlesnp_results <- rbind(multiple_myeloma_singlesnp_results_Egger,
                                            multiple_myeloma_singlesnp_results_IVW,
                                            multiple_myeloma_singlesnp_results_alpha,
                                            multiple_myeloma_singlesnp_results_amylin,
                                            multiple_myeloma_singlesnp_results_sulfonylureas,
                                            multiple_myeloma_singlesnp_results_biguanides,
                                            multiple_myeloma_singlesnp_results_dpp,
                                            multiple_myeloma_singlesnp_results_Insulins)

multiple_myeloma_singlesnp_results$or<-1/exp(multiple_myeloma_singlesnp_results$b)
multiple_myeloma_singlesnp_results$uci <- 1/exp(multiple_myeloma_singlesnp_results$b-1.96*multiple_myeloma_singlesnp_results$se)
multiple_myeloma_singlesnp_results$lci <- 1/exp(multiple_myeloma_singlesnp_results$b+1.96*multiple_myeloma_singlesnp_results$se)


####connective_tissue_cancer
outcome_gu<-read_tsv("gwas_data/connective_tissue_cancer.tsv")
outcome_gu$phenotype<- 'connective_tissue_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

connective_tissue_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(connective_tissue_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/connective_tissue_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

connective_tissue_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(connective_tissue_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/connective_tissue_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

connective_tissue_cancer_singlesnp_results_IVW <- filter(connective_tissue_cancer_singlesnp_results, 
                                                         SNP=="All - Inverse variance weighted")
connective_tissue_cancer_singlesnp_results_IVW$drug<-"combined"
connective_tissue_cancer_singlesnp_results_Egger <- filter(connective_tissue_cancer_singlesnp_results, 
                                                           SNP=="All - MR Egger")
connective_tissue_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


connective_tissue_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
connective_tissue_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

connective_tissue_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
connective_tissue_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

connective_tissue_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
connective_tissue_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

connective_tissue_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
connective_tissue_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

connective_tissue_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
connective_tissue_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

connective_tissue_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
connective_tissue_cancer_singlesnp_results_Insulins$drug<-"Insulins"


connective_tissue_cancer_singlesnp_results <- rbind(connective_tissue_cancer_singlesnp_results_Egger,
                                                    connective_tissue_cancer_singlesnp_results_IVW,
                                                    connective_tissue_cancer_singlesnp_results_alpha,
                                                    connective_tissue_cancer_singlesnp_results_amylin,
                                                    connective_tissue_cancer_singlesnp_results_sulfonylureas,
                                                    connective_tissue_cancer_singlesnp_results_biguanides,
                                                    connective_tissue_cancer_singlesnp_results_dpp,
                                                    connective_tissue_cancer_singlesnp_results_Insulins)

connective_tissue_cancer_singlesnp_results$or<-1/exp(connective_tissue_cancer_singlesnp_results$b)
connective_tissue_cancer_singlesnp_results$uci <- 1/exp(connective_tissue_cancer_singlesnp_results$b-1.96*connective_tissue_cancer_singlesnp_results$se)
connective_tissue_cancer_singlesnp_results$lci <- 1/exp(connective_tissue_cancer_singlesnp_results$b+1.96*connective_tissue_cancer_singlesnp_results$se)


list_of_datasets2 <- list("chronic_lymphocytic_leukemia" = chronic_lymphocytic_leukemia_leaveoneout_results,
                          "acute_myeloid_leukemia" = acute_myeloid_leukemia_leaveoneout_results,
                          "chronic_myelogenous_leukemia" = chronic_myelogenous_leukemia_leaveoneout_results, 
                          "hodgkin_lymphoma" = hodgkin_lymphoma_leaveoneout_results, 
                          "non_hodgkin_lymphoma" = non_hodgkin_lymphoma_leaveoneout_results, 
                          "multiple_myeloma" = multiple_myeloma_leaveoneout_results, 
                          "connective_tissue_cancer" = connective_tissue_cancer_leaveoneout_results)

write.xlsx(list_of_datasets2, file = "mr_output/met-c-859/leaveoneout_hematologic_system.xlsx")

list_of_datasets3 <- list("chronic_lymphocytic_leukemia" = chronic_lymphocytic_leukemia_singlesnp_results,
                          "acute_myeloid_leukemia" = acute_myeloid_leukemia_singlesnp_results, 
                          "chronic_myelogenous_leukemia" = chronic_myelogenous_leukemia_singlesnp_results, 
                          "hodgkin_lymphoma" = hodgkin_lymphoma_singlesnp_results, 
                          "non_hodgkin_lymphoma" = non_hodgkin_lymphoma_singlesnp_results, 
                          "multiple_myeloma" = multiple_myeloma_singlesnp_results, 
                          "connective_tissue_cancer" = connective_tissue_cancer_singlesnp_results)

write.xlsx(list_of_datasets3, file = "mr_output/met-c-859/singlesnp_hematologic_system.xlsx")


####bronchial_cancer
outcome_gu<-read_tsv("gwas_data/bronchial_cancer.tsv")
outcome_gu$phenotype<- 'bronchial_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

bronchial_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(bronchial_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/bronchial_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

bronchial_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(bronchial_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/bronchial_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

bronchial_cancer_singlesnp_results_IVW <- filter(bronchial_cancer_singlesnp_results, 
                                                 SNP=="All - Inverse variance weighted")
bronchial_cancer_singlesnp_results_IVW$drug<-"combined"
bronchial_cancer_singlesnp_results_Egger <- filter(bronchial_cancer_singlesnp_results, 
                                                   SNP=="All - MR Egger")
bronchial_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


bronchial_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bronchial_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

bronchial_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bronchial_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

bronchial_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bronchial_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

bronchial_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bronchial_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

bronchial_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bronchial_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

bronchial_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bronchial_cancer_singlesnp_results_Insulins$drug<-"Insulins"


bronchial_cancer_singlesnp_results <- rbind(bronchial_cancer_singlesnp_results_Egger,
                                            bronchial_cancer_singlesnp_results_IVW,
                                            bronchial_cancer_singlesnp_results_alpha,
                                            bronchial_cancer_singlesnp_results_amylin,
                                            bronchial_cancer_singlesnp_results_sulfonylureas,
                                            bronchial_cancer_singlesnp_results_biguanides,
                                            bronchial_cancer_singlesnp_results_dpp,
                                            bronchial_cancer_singlesnp_results_Insulins)

bronchial_cancer_singlesnp_results$or<-1/exp(bronchial_cancer_singlesnp_results$b)
bronchial_cancer_singlesnp_results$uci <- 1/exp(bronchial_cancer_singlesnp_results$b-1.96*bronchial_cancer_singlesnp_results$se)
bronchial_cancer_singlesnp_results$lci <- 1/exp(bronchial_cancer_singlesnp_results$b+1.96*bronchial_cancer_singlesnp_results$se)


####lung_adenocarcinoma
outcome_gu<-read_tsv("gwas_data/lung_adenocarcinoma.tsv")
outcome_gu$phenotype<- 'lung_adenocarcinoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

lung_adenocarcinoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(lung_adenocarcinoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/lung_adenocarcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

lung_adenocarcinoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(lung_adenocarcinoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/lung_adenocarcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

lung_adenocarcinoma_singlesnp_results_IVW <- filter(lung_adenocarcinoma_singlesnp_results, 
                                                    SNP=="All - Inverse variance weighted")
lung_adenocarcinoma_singlesnp_results_IVW$drug<-"combined"
lung_adenocarcinoma_singlesnp_results_Egger <- filter(lung_adenocarcinoma_singlesnp_results, 
                                                      SNP=="All - MR Egger")
lung_adenocarcinoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


lung_adenocarcinoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
lung_adenocarcinoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

lung_adenocarcinoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
lung_adenocarcinoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

lung_adenocarcinoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
lung_adenocarcinoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

lung_adenocarcinoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
lung_adenocarcinoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

lung_adenocarcinoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
lung_adenocarcinoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

lung_adenocarcinoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
lung_adenocarcinoma_singlesnp_results_Insulins$drug<-"Insulins"


lung_adenocarcinoma_singlesnp_results <- rbind(lung_adenocarcinoma_singlesnp_results_Egger,
                                               lung_adenocarcinoma_singlesnp_results_IVW,
                                               lung_adenocarcinoma_singlesnp_results_alpha,
                                               lung_adenocarcinoma_singlesnp_results_amylin,
                                               lung_adenocarcinoma_singlesnp_results_sulfonylureas,
                                               lung_adenocarcinoma_singlesnp_results_biguanides,
                                               lung_adenocarcinoma_singlesnp_results_dpp,
                                               lung_adenocarcinoma_singlesnp_results_Insulins)

lung_adenocarcinoma_singlesnp_results$or<-1/exp(lung_adenocarcinoma_singlesnp_results$b)
lung_adenocarcinoma_singlesnp_results$uci <- 1/exp(lung_adenocarcinoma_singlesnp_results$b-1.96*lung_adenocarcinoma_singlesnp_results$se)
lung_adenocarcinoma_singlesnp_results$lci <- 1/exp(lung_adenocarcinoma_singlesnp_results$b+1.96*lung_adenocarcinoma_singlesnp_results$se)


####pleural_mesothelioma
outcome_gu<-read_tsv("gwas_data/pleural_mesothelioma.tsv")
outcome_gu$phenotype<- 'pleural_mesothelioma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

pleural_mesothelioma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(pleural_mesothelioma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/pleural_mesothelioma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

pleural_mesothelioma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(pleural_mesothelioma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/pleural_mesothelioma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

pleural_mesothelioma_singlesnp_results_IVW <- filter(pleural_mesothelioma_singlesnp_results, 
                                                     SNP=="All - Inverse variance weighted")
pleural_mesothelioma_singlesnp_results_IVW$drug<-"combined"
pleural_mesothelioma_singlesnp_results_Egger <- filter(pleural_mesothelioma_singlesnp_results, 
                                                       SNP=="All - MR Egger")
pleural_mesothelioma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


pleural_mesothelioma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pleural_mesothelioma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

pleural_mesothelioma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pleural_mesothelioma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

pleural_mesothelioma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pleural_mesothelioma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

pleural_mesothelioma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pleural_mesothelioma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

pleural_mesothelioma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pleural_mesothelioma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

pleural_mesothelioma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pleural_mesothelioma_singlesnp_results_Insulins$drug<-"Insulins"


pleural_mesothelioma_singlesnp_results <- rbind(pleural_mesothelioma_singlesnp_results_Egger,
                                                pleural_mesothelioma_singlesnp_results_IVW,
                                                pleural_mesothelioma_singlesnp_results_alpha,
                                                pleural_mesothelioma_singlesnp_results_amylin,
                                                pleural_mesothelioma_singlesnp_results_sulfonylureas,
                                                pleural_mesothelioma_singlesnp_results_biguanides,
                                                pleural_mesothelioma_singlesnp_results_dpp,
                                                pleural_mesothelioma_singlesnp_results_Insulins)

pleural_mesothelioma_singlesnp_results$or<-1/exp(pleural_mesothelioma_singlesnp_results$b)
pleural_mesothelioma_singlesnp_results$uci <- 1/exp(pleural_mesothelioma_singlesnp_results$b-1.96*pleural_mesothelioma_singlesnp_results$se)
pleural_mesothelioma_singlesnp_results$lci <- 1/exp(pleural_mesothelioma_singlesnp_results$b+1.96*pleural_mesothelioma_singlesnp_results$se)


####small_cell_lung_carcinoma
outcome_gu<-read_tsv("gwas_data/small_cell_lung_carcinoma.tsv")
outcome_gu$phenotype<- 'small_cell_lung_carcinoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

small_cell_lung_carcinoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(small_cell_lung_carcinoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/small_cell_lung_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

small_cell_lung_carcinoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(small_cell_lung_carcinoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/small_cell_lung_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

small_cell_lung_carcinoma_singlesnp_results_IVW <- filter(small_cell_lung_carcinoma_singlesnp_results, 
                                                          SNP=="All - Inverse variance weighted")
small_cell_lung_carcinoma_singlesnp_results_IVW$drug<-"combined"
small_cell_lung_carcinoma_singlesnp_results_Egger <- filter(small_cell_lung_carcinoma_singlesnp_results, 
                                                            SNP=="All - MR Egger")
small_cell_lung_carcinoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


small_cell_lung_carcinoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_cell_lung_carcinoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

small_cell_lung_carcinoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_cell_lung_carcinoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

small_cell_lung_carcinoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_cell_lung_carcinoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

small_cell_lung_carcinoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_cell_lung_carcinoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

small_cell_lung_carcinoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_cell_lung_carcinoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

small_cell_lung_carcinoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_cell_lung_carcinoma_singlesnp_results_Insulins$drug<-"Insulins"


small_cell_lung_carcinoma_singlesnp_results <- rbind(small_cell_lung_carcinoma_singlesnp_results_Egger,
                                                     small_cell_lung_carcinoma_singlesnp_results_IVW,
                                                     small_cell_lung_carcinoma_singlesnp_results_alpha,
                                                     small_cell_lung_carcinoma_singlesnp_results_amylin,
                                                     small_cell_lung_carcinoma_singlesnp_results_sulfonylureas,
                                                     small_cell_lung_carcinoma_singlesnp_results_biguanides,
                                                     small_cell_lung_carcinoma_singlesnp_results_dpp,
                                                     small_cell_lung_carcinoma_singlesnp_results_Insulins)

small_cell_lung_carcinoma_singlesnp_results$or<-1/exp(small_cell_lung_carcinoma_singlesnp_results$b)
small_cell_lung_carcinoma_singlesnp_results$uci <- 1/exp(small_cell_lung_carcinoma_singlesnp_results$b-1.96*small_cell_lung_carcinoma_singlesnp_results$se)
small_cell_lung_carcinoma_singlesnp_results$lci <- 1/exp(small_cell_lung_carcinoma_singlesnp_results$b+1.96*small_cell_lung_carcinoma_singlesnp_results$se)


####squamous_cell_lung_carcinoma
outcome_gu<-read_tsv("gwas_data/squamous_cell_lung_carcinoma.tsv")
outcome_gu$phenotype<- 'squamous_cell_lung_carcinoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

squamous_cell_lung_carcinoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(squamous_cell_lung_carcinoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/squamous_cell_lung_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

squamous_cell_lung_carcinoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(squamous_cell_lung_carcinoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/squamous_cell_lung_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

squamous_cell_lung_carcinoma_singlesnp_results_IVW <- filter(squamous_cell_lung_carcinoma_singlesnp_results, 
                                                             SNP=="All - Inverse variance weighted")
squamous_cell_lung_carcinoma_singlesnp_results_IVW$drug<-"combined"
squamous_cell_lung_carcinoma_singlesnp_results_Egger <- filter(squamous_cell_lung_carcinoma_singlesnp_results, 
                                                               SNP=="All - MR Egger")
squamous_cell_lung_carcinoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


squamous_cell_lung_carcinoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_lung_carcinoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

squamous_cell_lung_carcinoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_lung_carcinoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

squamous_cell_lung_carcinoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_lung_carcinoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

squamous_cell_lung_carcinoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_lung_carcinoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

squamous_cell_lung_carcinoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_lung_carcinoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

squamous_cell_lung_carcinoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_lung_carcinoma_singlesnp_results_Insulins$drug<-"Insulins"


squamous_cell_lung_carcinoma_singlesnp_results <- rbind(squamous_cell_lung_carcinoma_singlesnp_results_Egger,
                                                        squamous_cell_lung_carcinoma_singlesnp_results_IVW,
                                                        squamous_cell_lung_carcinoma_singlesnp_results_alpha,
                                                        squamous_cell_lung_carcinoma_singlesnp_results_amylin,
                                                        squamous_cell_lung_carcinoma_singlesnp_results_sulfonylureas,
                                                        squamous_cell_lung_carcinoma_singlesnp_results_biguanides,
                                                        squamous_cell_lung_carcinoma_singlesnp_results_dpp,
                                                        squamous_cell_lung_carcinoma_singlesnp_results_Insulins)

squamous_cell_lung_carcinoma_singlesnp_results$or<-1/exp(squamous_cell_lung_carcinoma_singlesnp_results$b)
squamous_cell_lung_carcinoma_singlesnp_results$uci <- 1/exp(squamous_cell_lung_carcinoma_singlesnp_results$b-1.96*squamous_cell_lung_carcinoma_singlesnp_results$se)
squamous_cell_lung_carcinoma_singlesnp_results$lci <- 1/exp(squamous_cell_lung_carcinoma_singlesnp_results$b+1.96*squamous_cell_lung_carcinoma_singlesnp_results$se)


list_of_datasets2 <- list("bronchial_cancer" = bronchial_cancer_leaveoneout_results,
                          "lung_adenocarcinoma" = lung_adenocarcinoma_leaveoneout_results, 
                          "pleural_mesothelioma" = pleural_mesothelioma_leaveoneout_results, 
                          "small_cell_lung_carcinoma" = small_cell_lung_carcinoma_leaveoneout_results, 
                          "squamous_cell_lung_carcinoma" = squamous_cell_lung_carcinoma_leaveoneout_results)

write.xlsx(list_of_datasets2, file = "mr_output/met-c-859/leaveoneout_respiratory_system.xlsx")

list_of_datasets3 <- list("bronchial_cancer" = bronchial_cancer_singlesnp_results,
                          "lung_adenocarcinoma" = lung_adenocarcinoma_singlesnp_results, 
                          "pleural_mesothelioma" = pleural_mesothelioma_singlesnp_results, 
                          "small_cell_lung_carcinoma" = small_cell_lung_carcinoma_singlesnp_results, 
                          "squamous_cell_lung_carcinoma" = squamous_cell_lung_carcinoma_singlesnp_results)

write.xlsx(list_of_datasets3, file = "mr_output/met-c-859/singlesnp_respiratory_system.xlsx")



####melanoma
outcome_gu<-read_tsv("gwas_data/melanoma.tsv")
outcome_gu$phenotype<- 'melanoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

melanoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(melanoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/melanoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

melanoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(melanoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/melanoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

melanoma_singlesnp_results_IVW <- filter(melanoma_singlesnp_results, 
                                         SNP=="All - Inverse variance weighted")
melanoma_singlesnp_results_IVW$drug<-"combined"
melanoma_singlesnp_results_Egger <- filter(melanoma_singlesnp_results, 
                                           SNP=="All - MR Egger")
melanoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


melanoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
melanoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

melanoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
melanoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

melanoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
melanoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

melanoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
melanoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

melanoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
melanoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

melanoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
melanoma_singlesnp_results_Insulins$drug<-"Insulins"


melanoma_singlesnp_results <- rbind(melanoma_singlesnp_results_Egger,
                                    melanoma_singlesnp_results_IVW,
                                    melanoma_singlesnp_results_alpha,
                                    melanoma_singlesnp_results_amylin,
                                    melanoma_singlesnp_results_sulfonylureas,
                                    melanoma_singlesnp_results_biguanides,
                                    melanoma_singlesnp_results_dpp,
                                    melanoma_singlesnp_results_Insulins)

melanoma_singlesnp_results$or<-1/exp(melanoma_singlesnp_results$b)
melanoma_singlesnp_results$uci <- 1/exp(melanoma_singlesnp_results$b-1.96*melanoma_singlesnp_results$se)
melanoma_singlesnp_results$lci <- 1/exp(melanoma_singlesnp_results$b+1.96*melanoma_singlesnp_results$se)


####squamous_cell_carcinoma
outcome_gu<-read_tsv("gwas_data/squamous_cell_carcinoma.tsv")
outcome_gu$phenotype<- 'squamous_cell_carcinoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

squamous_cell_carcinoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(squamous_cell_carcinoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/squamous_cell_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

squamous_cell_carcinoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(squamous_cell_carcinoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/squamous_cell_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

squamous_cell_carcinoma_singlesnp_results_IVW <- filter(squamous_cell_carcinoma_singlesnp_results, 
                                                        SNP=="All - Inverse variance weighted")
squamous_cell_carcinoma_singlesnp_results_IVW$drug<-"combined"
squamous_cell_carcinoma_singlesnp_results_Egger <- filter(squamous_cell_carcinoma_singlesnp_results, 
                                                          SNP=="All - MR Egger")
squamous_cell_carcinoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


squamous_cell_carcinoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_carcinoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

squamous_cell_carcinoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_carcinoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

squamous_cell_carcinoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_carcinoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

squamous_cell_carcinoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_carcinoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

squamous_cell_carcinoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_carcinoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

squamous_cell_carcinoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
squamous_cell_carcinoma_singlesnp_results_Insulins$drug<-"Insulins"


squamous_cell_carcinoma_singlesnp_results <- rbind(squamous_cell_carcinoma_singlesnp_results_Egger,
                                                   squamous_cell_carcinoma_singlesnp_results_IVW,
                                                   squamous_cell_carcinoma_singlesnp_results_alpha,
                                                   squamous_cell_carcinoma_singlesnp_results_amylin,
                                                   squamous_cell_carcinoma_singlesnp_results_sulfonylureas,
                                                   squamous_cell_carcinoma_singlesnp_results_biguanides,
                                                   squamous_cell_carcinoma_singlesnp_results_dpp,
                                                   squamous_cell_carcinoma_singlesnp_results_Insulins)

squamous_cell_carcinoma_singlesnp_results$or<-1/exp(squamous_cell_carcinoma_singlesnp_results$b)
squamous_cell_carcinoma_singlesnp_results$uci <- 1/exp(squamous_cell_carcinoma_singlesnp_results$b-1.96*squamous_cell_carcinoma_singlesnp_results$se)
squamous_cell_carcinoma_singlesnp_results$lci <- 1/exp(squamous_cell_carcinoma_singlesnp_results$b+1.96*squamous_cell_carcinoma_singlesnp_results$se)


####basal_cell_carcinoma
outcome_gu<-read_tsv("gwas_data/basal_cell_carcinoma.tsv")
outcome_gu$phenotype<- 'basal_cell_carcinoma'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

basal_cell_carcinoma_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(basal_cell_carcinoma_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/basal_cell_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

basal_cell_carcinoma_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(basal_cell_carcinoma_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/basal_cell_carcinoma.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

basal_cell_carcinoma_singlesnp_results_IVW <- filter(basal_cell_carcinoma_singlesnp_results, 
                                                     SNP=="All - Inverse variance weighted")
basal_cell_carcinoma_singlesnp_results_IVW$drug<-"combined"
basal_cell_carcinoma_singlesnp_results_Egger <- filter(basal_cell_carcinoma_singlesnp_results, 
                                                       SNP=="All - MR Egger")
basal_cell_carcinoma_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


basal_cell_carcinoma_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
basal_cell_carcinoma_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

basal_cell_carcinoma_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
basal_cell_carcinoma_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

basal_cell_carcinoma_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
basal_cell_carcinoma_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

basal_cell_carcinoma_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
basal_cell_carcinoma_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

basal_cell_carcinoma_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
basal_cell_carcinoma_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

basal_cell_carcinoma_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
basal_cell_carcinoma_singlesnp_results_Insulins$drug<-"Insulins"


basal_cell_carcinoma_singlesnp_results <- rbind(basal_cell_carcinoma_singlesnp_results_Egger,
                                                basal_cell_carcinoma_singlesnp_results_IVW,
                                                basal_cell_carcinoma_singlesnp_results_alpha,
                                                basal_cell_carcinoma_singlesnp_results_amylin,
                                                basal_cell_carcinoma_singlesnp_results_sulfonylureas,
                                                basal_cell_carcinoma_singlesnp_results_biguanides,
                                                basal_cell_carcinoma_singlesnp_results_dpp,
                                                basal_cell_carcinoma_singlesnp_results_Insulins)

basal_cell_carcinoma_singlesnp_results$or<-1/exp(basal_cell_carcinoma_singlesnp_results$b)
basal_cell_carcinoma_singlesnp_results$uci <- 1/exp(basal_cell_carcinoma_singlesnp_results$b-1.96*basal_cell_carcinoma_singlesnp_results$se)
basal_cell_carcinoma_singlesnp_results$lci <- 1/exp(basal_cell_carcinoma_singlesnp_results$b+1.96*basal_cell_carcinoma_singlesnp_results$se)


list_of_datasets2 <- list("melanoma" = melanoma_leaveoneout_results,
                          "squamous_cell_carcinoma" = squamous_cell_carcinoma_leaveoneout_results, 
                          "basal_cell_carcinoma" = basal_cell_carcinoma_leaveoneout_results)

write.xlsx(list_of_datasets2, file = "mr_output/met-c-859/leaveoneout_skin_system.xlsx")

list_of_datasets3 <- list("melanoma" = melanoma_singlesnp_results,
                          "squamous_cell_carcinoma" = squamous_cell_carcinoma_singlesnp_results, 
                          "basal_cell_carcinoma" = basal_cell_carcinoma_singlesnp_results)
write.xlsx(list_of_datasets3, file = "mr_output/met-c-859/singlesnp_skin_system.xlsx")


####breast_cancer
outcome_gu<-read_tsv("gwas_data/breast_cancer.tsv")
outcome_gu$phenotype<- 'breast_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

breast_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(breast_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/breast_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

breast_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(breast_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/breast_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

breast_cancer_singlesnp_results_IVW <- filter(breast_cancer_singlesnp_results, 
                                              SNP=="All - Inverse variance weighted")
breast_cancer_singlesnp_results_IVW$drug<-"combined"
breast_cancer_singlesnp_results_Egger <- filter(breast_cancer_singlesnp_results, 
                                                SNP=="All - MR Egger")
breast_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


breast_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
breast_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

breast_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
breast_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

breast_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
breast_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

breast_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
breast_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

breast_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
breast_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

breast_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
breast_cancer_singlesnp_results_Insulins$drug<-"Insulins"


breast_cancer_singlesnp_results <- rbind(breast_cancer_singlesnp_results_Egger,
                                         breast_cancer_singlesnp_results_IVW,
                                         breast_cancer_singlesnp_results_alpha,
                                         breast_cancer_singlesnp_results_amylin,
                                         breast_cancer_singlesnp_results_sulfonylureas,
                                         breast_cancer_singlesnp_results_biguanides,
                                         breast_cancer_singlesnp_results_dpp,
                                         breast_cancer_singlesnp_results_Insulins)

breast_cancer_singlesnp_results$or<-1/exp(breast_cancer_singlesnp_results$b)
breast_cancer_singlesnp_results$uci <- 1/exp(breast_cancer_singlesnp_results$b-1.96*breast_cancer_singlesnp_results$se)
breast_cancer_singlesnp_results$lci <- 1/exp(breast_cancer_singlesnp_results$b+1.96*breast_cancer_singlesnp_results$se)


####thyroid_cancer
outcome_gu<-read_tsv("gwas_data/thyroid_cancer.tsv")
outcome_gu$phenotype<- 'thyroid_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

thyroid_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(thyroid_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/thyroid_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

thyroid_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(thyroid_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/thyroid_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

thyroid_cancer_singlesnp_results_IVW <- filter(thyroid_cancer_singlesnp_results, 
                                               SNP=="All - Inverse variance weighted")
thyroid_cancer_singlesnp_results_IVW$drug<-"combined"
thyroid_cancer_singlesnp_results_Egger <- filter(thyroid_cancer_singlesnp_results, 
                                                 SNP=="All - MR Egger")
thyroid_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


thyroid_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
thyroid_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

thyroid_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
thyroid_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

thyroid_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
thyroid_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

thyroid_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
thyroid_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

thyroid_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
thyroid_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

thyroid_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
thyroid_cancer_singlesnp_results_Insulins$drug<-"Insulins"


thyroid_cancer_singlesnp_results <- rbind(thyroid_cancer_singlesnp_results_Egger,
                                          thyroid_cancer_singlesnp_results_IVW,
                                          thyroid_cancer_singlesnp_results_alpha,
                                          thyroid_cancer_singlesnp_results_amylin,
                                          thyroid_cancer_singlesnp_results_sulfonylureas,
                                          thyroid_cancer_singlesnp_results_biguanides,
                                          thyroid_cancer_singlesnp_results_dpp,
                                          thyroid_cancer_singlesnp_results_Insulins)

thyroid_cancer_singlesnp_results$or<-1/exp(thyroid_cancer_singlesnp_results$b)
thyroid_cancer_singlesnp_results$uci <- 1/exp(thyroid_cancer_singlesnp_results$b-1.96*thyroid_cancer_singlesnp_results$se)
thyroid_cancer_singlesnp_results$lci <- 1/exp(thyroid_cancer_singlesnp_results$b+1.96*thyroid_cancer_singlesnp_results$se)


####eye_cancer
outcome_gu<-read_tsv("gwas_data/eye_cancer.tsv")
outcome_gu$phenotype<- 'eye_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

eye_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(eye_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/eye_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

eye_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(eye_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/eye_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

eye_cancer_singlesnp_results_IVW <- filter(eye_cancer_singlesnp_results, 
                                           SNP=="All - Inverse variance weighted")
eye_cancer_singlesnp_results_IVW$drug<-"combined"
eye_cancer_singlesnp_results_Egger <- filter(eye_cancer_singlesnp_results, 
                                             SNP=="All - MR Egger")
eye_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


eye_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
eye_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

eye_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
eye_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

eye_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
eye_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

eye_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
eye_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

eye_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
eye_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

eye_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
eye_cancer_singlesnp_results_Insulins$drug<-"Insulins"


eye_cancer_singlesnp_results <- rbind(eye_cancer_singlesnp_results_Egger,
                                      eye_cancer_singlesnp_results_IVW,
                                      eye_cancer_singlesnp_results_alpha,
                                      eye_cancer_singlesnp_results_amylin,
                                      eye_cancer_singlesnp_results_sulfonylureas,
                                      eye_cancer_singlesnp_results_biguanides,
                                      eye_cancer_singlesnp_results_dpp,
                                      eye_cancer_singlesnp_results_Insulins)

eye_cancer_singlesnp_results$or<-1/exp(eye_cancer_singlesnp_results$b)
eye_cancer_singlesnp_results$uci <- 1/exp(eye_cancer_singlesnp_results$b-1.96*eye_cancer_singlesnp_results$se)
eye_cancer_singlesnp_results$lci <- 1/exp(eye_cancer_singlesnp_results$b+1.96*eye_cancer_singlesnp_results$se)


list_of_datasets2 <- list("breast_cancer" = breast_cancer_leaveoneout_results,
                          "thyroid_cancer" = thyroid_cancer_leaveoneout_results, 
                          "eye_cancer" = eye_cancer_leaveoneout_results)

write.xlsx(list_of_datasets2, file = "mr_output/met-c-859/leaveoneout_individual_final2.xlsx")

list_of_datasets3 <- list("breast_cancer" = breast_cancer_singlesnp_results,
                          "thyroid_cancer" = thyroid_cancer_singlesnp_results, 
                          "eye_cancer" = eye_cancer_singlesnp_results)

write.xlsx(list_of_datasets3, file = "mr_output/met-c-859/singlesnp_individual_final2.xlsx")


####anal_cancer
outcome_gu<-read_tsv("gwas_data/anal_cancer.tsv")
outcome_gu$phenotype<- 'anal_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

anal_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(anal_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/anal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

anal_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(anal_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/anal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

anal_cancer_singlesnp_results_IVW <- filter(anal_cancer_singlesnp_results, 
                                            SNP=="All - Inverse variance weighted")
anal_cancer_singlesnp_results_IVW$drug<-"combined"
anal_cancer_singlesnp_results_Egger <- filter(anal_cancer_singlesnp_results, 
                                              SNP=="All - MR Egger")
anal_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


anal_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
anal_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

anal_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
anal_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

anal_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
anal_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

anal_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
anal_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

anal_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
anal_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

anal_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
anal_cancer_singlesnp_results_Insulins$drug<-"Insulins"


anal_cancer_singlesnp_results <- rbind(anal_cancer_singlesnp_results_Egger,
                                       anal_cancer_singlesnp_results_IVW,
                                       anal_cancer_singlesnp_results_alpha,
                                       anal_cancer_singlesnp_results_amylin,
                                       anal_cancer_singlesnp_results_sulfonylureas,
                                       anal_cancer_singlesnp_results_biguanides,
                                       anal_cancer_singlesnp_results_dpp,
                                       anal_cancer_singlesnp_results_Insulins)

anal_cancer_singlesnp_results$or<-1/exp(anal_cancer_singlesnp_results$b)
anal_cancer_singlesnp_results$uci <- 1/exp(anal_cancer_singlesnp_results$b-1.96*anal_cancer_singlesnp_results$se)
anal_cancer_singlesnp_results$lci <- 1/exp(anal_cancer_singlesnp_results$b+1.96*anal_cancer_singlesnp_results$se)


####bile_duct_cancer
outcome_gu<-read_tsv("gwas_data/bile_duct_cancer.tsv")
outcome_gu$phenotype<- 'bile_duct_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

bile_duct_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(bile_duct_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/bile_duct_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

bile_duct_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(bile_duct_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/bile_duct_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

bile_duct_cancer_singlesnp_results_IVW <- filter(bile_duct_cancer_singlesnp_results, 
                                                 SNP=="All - Inverse variance weighted")
bile_duct_cancer_singlesnp_results_IVW$drug<-"combined"
bile_duct_cancer_singlesnp_results_Egger <- filter(bile_duct_cancer_singlesnp_results, 
                                                   SNP=="All - MR Egger")
bile_duct_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


bile_duct_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bile_duct_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

bile_duct_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bile_duct_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

bile_duct_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bile_duct_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

bile_duct_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bile_duct_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

bile_duct_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bile_duct_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

bile_duct_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
bile_duct_cancer_singlesnp_results_Insulins$drug<-"Insulins"


bile_duct_cancer_singlesnp_results <- rbind(bile_duct_cancer_singlesnp_results_Egger,
                                            bile_duct_cancer_singlesnp_results_IVW,
                                            bile_duct_cancer_singlesnp_results_alpha,
                                            bile_duct_cancer_singlesnp_results_amylin,
                                            bile_duct_cancer_singlesnp_results_sulfonylureas,
                                            bile_duct_cancer_singlesnp_results_biguanides,
                                            bile_duct_cancer_singlesnp_results_dpp,
                                            bile_duct_cancer_singlesnp_results_Insulins)

bile_duct_cancer_singlesnp_results$or<-1/exp(bile_duct_cancer_singlesnp_results$b)
bile_duct_cancer_singlesnp_results$uci <- 1/exp(bile_duct_cancer_singlesnp_results$b-1.96*bile_duct_cancer_singlesnp_results$se)
bile_duct_cancer_singlesnp_results$lci <- 1/exp(bile_duct_cancer_singlesnp_results$b+1.96*bile_duct_cancer_singlesnp_results$se)


####colon_cancer
outcome_gu<-read_tsv("gwas_data/colon_cancer.tsv")
outcome_gu$phenotype<- 'colon_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

colon_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(colon_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/colon_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

colon_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(colon_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/colon_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

colon_cancer_singlesnp_results_IVW <- filter(colon_cancer_singlesnp_results, 
                                             SNP=="All - Inverse variance weighted")
colon_cancer_singlesnp_results_IVW$drug<-"combined"
colon_cancer_singlesnp_results_Egger <- filter(colon_cancer_singlesnp_results, 
                                               SNP=="All - MR Egger")
colon_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


colon_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
colon_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

colon_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
colon_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

colon_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
colon_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

colon_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
colon_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

colon_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
colon_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

colon_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
colon_cancer_singlesnp_results_Insulins$drug<-"Insulins"


colon_cancer_singlesnp_results <- rbind(colon_cancer_singlesnp_results_Egger,
                                        colon_cancer_singlesnp_results_IVW,
                                        colon_cancer_singlesnp_results_alpha,
                                        colon_cancer_singlesnp_results_amylin,
                                        colon_cancer_singlesnp_results_sulfonylureas,
                                        colon_cancer_singlesnp_results_biguanides,
                                        colon_cancer_singlesnp_results_dpp,
                                        colon_cancer_singlesnp_results_Insulins)

colon_cancer_singlesnp_results$or<-1/exp(colon_cancer_singlesnp_results$b)
colon_cancer_singlesnp_results$uci <- 1/exp(colon_cancer_singlesnp_results$b-1.96*colon_cancer_singlesnp_results$se)
colon_cancer_singlesnp_results$lci <- 1/exp(colon_cancer_singlesnp_results$b+1.96*colon_cancer_singlesnp_results$se)


####esophageal_cancer
outcome_gu<-read_tsv("gwas_data/esophageal_cancer.tsv")
outcome_gu$phenotype<- 'esophageal_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

esophageal_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(esophageal_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/esophageal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

esophageal_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(esophageal_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/esophageal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

esophageal_cancer_singlesnp_results_IVW <- filter(esophageal_cancer_singlesnp_results, 
                                                  SNP=="All - Inverse variance weighted")
esophageal_cancer_singlesnp_results_IVW$drug<-"combined"
esophageal_cancer_singlesnp_results_Egger <- filter(esophageal_cancer_singlesnp_results, 
                                                    SNP=="All - MR Egger")
esophageal_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


esophageal_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
esophageal_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

esophageal_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
esophageal_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

esophageal_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
esophageal_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

esophageal_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
esophageal_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

esophageal_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
esophageal_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

esophageal_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
esophageal_cancer_singlesnp_results_Insulins$drug<-"Insulins"


esophageal_cancer_singlesnp_results <- rbind(esophageal_cancer_singlesnp_results_Egger,
                                             esophageal_cancer_singlesnp_results_IVW,
                                             esophageal_cancer_singlesnp_results_alpha,
                                             esophageal_cancer_singlesnp_results_amylin,
                                             esophageal_cancer_singlesnp_results_sulfonylureas,
                                             esophageal_cancer_singlesnp_results_biguanides,
                                             esophageal_cancer_singlesnp_results_dpp,
                                             esophageal_cancer_singlesnp_results_Insulins)

esophageal_cancer_singlesnp_results$or<-1/exp(esophageal_cancer_singlesnp_results$b)
esophageal_cancer_singlesnp_results$uci <- 1/exp(esophageal_cancer_singlesnp_results$b-1.96*esophageal_cancer_singlesnp_results$se)
esophageal_cancer_singlesnp_results$lci <- 1/exp(esophageal_cancer_singlesnp_results$b+1.96*esophageal_cancer_singlesnp_results$se)


####gastric_cancer
outcome_gu<-read_tsv("gwas_data/gastric_cancer.tsv")
outcome_gu$phenotype<- 'gastric_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

gastric_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(gastric_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/gastric_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

gastric_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(gastric_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/gastric_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

gastric_cancer_singlesnp_results_IVW <- filter(gastric_cancer_singlesnp_results, 
                                               SNP=="All - Inverse variance weighted")
gastric_cancer_singlesnp_results_IVW$drug<-"combined"
gastric_cancer_singlesnp_results_Egger <- filter(gastric_cancer_singlesnp_results, 
                                                 SNP=="All - MR Egger")
gastric_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


gastric_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
gastric_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

gastric_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
gastric_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

gastric_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
gastric_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

gastric_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
gastric_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

gastric_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
gastric_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

gastric_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
gastric_cancer_singlesnp_results_Insulins$drug<-"Insulins"


gastric_cancer_singlesnp_results <- rbind(gastric_cancer_singlesnp_results_Egger,
                                          gastric_cancer_singlesnp_results_IVW,
                                          gastric_cancer_singlesnp_results_alpha,
                                          gastric_cancer_singlesnp_results_amylin,
                                          gastric_cancer_singlesnp_results_sulfonylureas,
                                          gastric_cancer_singlesnp_results_biguanides,
                                          gastric_cancer_singlesnp_results_dpp,
                                          gastric_cancer_singlesnp_results_Insulins)

gastric_cancer_singlesnp_results$or<-1/exp(gastric_cancer_singlesnp_results$b)
gastric_cancer_singlesnp_results$uci <- 1/exp(gastric_cancer_singlesnp_results$b-1.96*gastric_cancer_singlesnp_results$se)
gastric_cancer_singlesnp_results$lci <- 1/exp(gastric_cancer_singlesnp_results$b+1.96*gastric_cancer_singlesnp_results$se)


####liver_cancer
outcome_gu<-read_tsv("gwas_data/liver_cancer.tsv")
outcome_gu$phenotype<- 'liver_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

liver_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(liver_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/liver_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

liver_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(liver_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/liver_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

liver_cancer_singlesnp_results_IVW <- filter(liver_cancer_singlesnp_results, 
                                             SNP=="All - Inverse variance weighted")
liver_cancer_singlesnp_results_IVW$drug<-"combined"
liver_cancer_singlesnp_results_Egger <- filter(liver_cancer_singlesnp_results, 
                                               SNP=="All - MR Egger")
liver_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


liver_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
liver_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

liver_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
liver_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

liver_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
liver_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

liver_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
liver_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

liver_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
liver_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

liver_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
liver_cancer_singlesnp_results_Insulins$drug<-"Insulins"


liver_cancer_singlesnp_results <- rbind(liver_cancer_singlesnp_results_Egger,
                                        liver_cancer_singlesnp_results_IVW,
                                        liver_cancer_singlesnp_results_alpha,
                                        liver_cancer_singlesnp_results_amylin,
                                        liver_cancer_singlesnp_results_sulfonylureas,
                                        liver_cancer_singlesnp_results_biguanides,
                                        liver_cancer_singlesnp_results_dpp,
                                        liver_cancer_singlesnp_results_Insulins)

liver_cancer_singlesnp_results$or<-1/exp(liver_cancer_singlesnp_results$b)
liver_cancer_singlesnp_results$uci <- 1/exp(liver_cancer_singlesnp_results$b-1.96*liver_cancer_singlesnp_results$se)
liver_cancer_singlesnp_results$lci <- 1/exp(liver_cancer_singlesnp_results$b+1.96*liver_cancer_singlesnp_results$se)


####pancreatic_cancer
outcome_gu<-read_tsv("gwas_data/pancreatic_cancer.tsv")
outcome_gu$phenotype<- 'pancreatic_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

pancreatic_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(pancreatic_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/pancreatic_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

pancreatic_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(pancreatic_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/pancreatic_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

pancreatic_cancer_singlesnp_results_IVW <- filter(pancreatic_cancer_singlesnp_results, 
                                                  SNP=="All - Inverse variance weighted")
pancreatic_cancer_singlesnp_results_IVW$drug<-"combined"
pancreatic_cancer_singlesnp_results_Egger <- filter(pancreatic_cancer_singlesnp_results, 
                                                    SNP=="All - MR Egger")
pancreatic_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


pancreatic_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pancreatic_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

pancreatic_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pancreatic_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

pancreatic_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pancreatic_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

pancreatic_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pancreatic_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

pancreatic_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pancreatic_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

pancreatic_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
pancreatic_cancer_singlesnp_results_Insulins$drug<-"Insulins"


pancreatic_cancer_singlesnp_results <- rbind(pancreatic_cancer_singlesnp_results_Egger,
                                             pancreatic_cancer_singlesnp_results_IVW,
                                             pancreatic_cancer_singlesnp_results_alpha,
                                             pancreatic_cancer_singlesnp_results_amylin,
                                             pancreatic_cancer_singlesnp_results_sulfonylureas,
                                             pancreatic_cancer_singlesnp_results_biguanides,
                                             pancreatic_cancer_singlesnp_results_dpp,
                                             pancreatic_cancer_singlesnp_results_Insulins)

pancreatic_cancer_singlesnp_results$or<-1/exp(pancreatic_cancer_singlesnp_results$b)
pancreatic_cancer_singlesnp_results$uci <- 1/exp(pancreatic_cancer_singlesnp_results$b-1.96*pancreatic_cancer_singlesnp_results$se)
pancreatic_cancer_singlesnp_results$lci <- 1/exp(pancreatic_cancer_singlesnp_results$b+1.96*pancreatic_cancer_singlesnp_results$se)


####rectal_cancer
outcome_gu<-read_tsv("gwas_data/rectal_cancer.tsv")
outcome_gu$phenotype<- 'rectal_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

rectal_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(rectal_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/rectal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

rectal_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(rectal_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/rectal_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

rectal_cancer_singlesnp_results_IVW <- filter(rectal_cancer_singlesnp_results, 
                                              SNP=="All - Inverse variance weighted")
rectal_cancer_singlesnp_results_IVW$drug<-"combined"
rectal_cancer_singlesnp_results_Egger <- filter(rectal_cancer_singlesnp_results, 
                                                SNP=="All - MR Egger")
rectal_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


rectal_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
rectal_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

rectal_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
rectal_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

rectal_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
rectal_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

rectal_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
rectal_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

rectal_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
rectal_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

rectal_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
rectal_cancer_singlesnp_results_Insulins$drug<-"Insulins"


rectal_cancer_singlesnp_results <- rbind(rectal_cancer_singlesnp_results_Egger,
                                         rectal_cancer_singlesnp_results_IVW,
                                         rectal_cancer_singlesnp_results_alpha,
                                         rectal_cancer_singlesnp_results_amylin,
                                         rectal_cancer_singlesnp_results_sulfonylureas,
                                         rectal_cancer_singlesnp_results_biguanides,
                                         rectal_cancer_singlesnp_results_dpp,
                                         rectal_cancer_singlesnp_results_Insulins)

rectal_cancer_singlesnp_results$or<-1/exp(rectal_cancer_singlesnp_results$b)
rectal_cancer_singlesnp_results$uci <- 1/exp(rectal_cancer_singlesnp_results$b-1.96*rectal_cancer_singlesnp_results$se)
rectal_cancer_singlesnp_results$lci <- 1/exp(rectal_cancer_singlesnp_results$b+1.96*rectal_cancer_singlesnp_results$se)


####small_intestine_cancer
outcome_gu<-read_tsv("gwas_data/small_intestine_cancer.tsv")
outcome_gu$phenotype<- 'small_intestine_cancer'


outcome_dat <- format_data(
  dat=outcome_gu,
  type = "outcome", 
  snps = input_glu$SNP,
  header = TRUE,
  phenotype_col = "phenotype",
  snp_col = "variant_id",
  beta_col = "beta",
  se_col = "standard_error",
  effect_allele_col = "effect_allele",
  other_allele_col = "other_allele",
  pval_col = "p_value",
)
H_data1 <- harmonise_data(
  exposure_dat = exp_dat, 
  outcome_dat = outcome_dat
)

small_intestine_cancer_singlesnp_results<-mr_singlesnp(
  H_data1,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
mr_forest_plot(small_intestine_cancer_singlesnp_results, exponentiate = FALSE)
ggsave("mr_output/met-c-859/system_final/forest/small_intestine_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

small_intestine_cancer_leaveoneout_results<-mr_leaveoneout(H_data1, parameters = default_parameters(), method = mr_ivw)
mr_leaveoneout_plot(small_intestine_cancer_leaveoneout_results)
ggsave("mr_output/met-c-859/system_final/leaveoneout/small_intestine_cancer.jpeg",width = 200, height = 300, unit = "mm", dpi = 600)

small_intestine_cancer_singlesnp_results_IVW <- filter(small_intestine_cancer_singlesnp_results, 
                                                       SNP=="All - Inverse variance weighted")
small_intestine_cancer_singlesnp_results_IVW$drug<-"combined"
small_intestine_cancer_singlesnp_results_Egger <- filter(small_intestine_cancer_singlesnp_results, 
                                                         SNP=="All - MR Egger")
small_intestine_cancer_singlesnp_results_Egger$drug<-"combined"

H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Alpha glucosidase inhibitors")


small_intestine_cancer_singlesnp_results_alpha<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_intestine_cancer_singlesnp_results_alpha$drug<-"Alpha glucosidase inhibitors"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Amylin analog")

small_intestine_cancer_singlesnp_results_amylin<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_intestine_cancer_singlesnp_results_amylin$drug<-"Amylin analog"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Sulfonylureas")

small_intestine_cancer_singlesnp_results_sulfonylureas<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_intestine_cancer_singlesnp_results_sulfonylureas$drug<-"sulfonylureas"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "biguanides")

small_intestine_cancer_singlesnp_results_biguanides<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_intestine_cancer_singlesnp_results_biguanides$drug<-"Biguanides"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Dipeptidyl peptidase 4 (dpp-iv) inhibitor")

small_intestine_cancer_singlesnp_results_dpp<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_intestine_cancer_singlesnp_results_dpp$drug<-"Dipeptidyl peptidase 4 (dpp-iv) inhibitor"


H_data <- merge(SNP_drug,H_data1,by=c("SNP"),all.x = TRUE)
H_data<-filter(H_data, drug== "Insulins")

small_intestine_cancer_singlesnp_results_Insulins<-mr_singlesnp(
  H_data,
  parameters = default_parameters(),
  single_method = "mr_wald_ratio",
  all_method = c("mr_ivw", "mr_egger_regression")
)
small_intestine_cancer_singlesnp_results_Insulins$drug<-"Insulins"


small_intestine_cancer_singlesnp_results <- rbind(small_intestine_cancer_singlesnp_results_Egger,
                                                  small_intestine_cancer_singlesnp_results_IVW,
                                                  small_intestine_cancer_singlesnp_results_alpha,
                                                  small_intestine_cancer_singlesnp_results_amylin,
                                                  small_intestine_cancer_singlesnp_results_sulfonylureas,
                                                  small_intestine_cancer_singlesnp_results_biguanides,
                                                  small_intestine_cancer_singlesnp_results_dpp,
                                                  small_intestine_cancer_singlesnp_results_Insulins)

small_intestine_cancer_singlesnp_results$or<-1/exp(small_intestine_cancer_singlesnp_results$b)
small_intestine_cancer_singlesnp_results$uci <- 1/exp(small_intestine_cancer_singlesnp_results$b-1.96*small_intestine_cancer_singlesnp_results$se)
small_intestine_cancer_singlesnp_results$lci <- 1/exp(small_intestine_cancer_singlesnp_results$b+1.96*small_intestine_cancer_singlesnp_results$se)



list_of_datasets5 <- list("anal_cancer"= anal_cancer_singlesnp_results,
                          "bile_duct_cancer"= bile_duct_cancer_singlesnp_results,
                          "colon_cancer"= colon_cancer_singlesnp_results,
                          "esophageal_cancer"=  esophageal_cancer_singlesnp_results,
                          "gastric_cancer"= gastric_cancer_singlesnp_results,
                          "liver_cancer"= liver_cancer_singlesnp_results,
                          "pancreatic_cancer"= pancreatic_cancer_singlesnp_results,
                          "rectal_cancer"= rectal_cancer_singlesnp_results,
                          "small_intestine_cancer"= small_intestine_cancer_singlesnp_results)

write.xlsx(list_of_datasets5, file = "mr_output/met-c-859/singlesnp_gi_system2.xlsx")

list_of_datasets6 <- list("anal_cancer"= anal_cancer_leaveoneout_results,
                          "bile_duct_cancer"= bile_duct_cancer_leaveoneout_results,
                          "colon_cancer"= colon_cancer_leaveoneout_results,
                          "esophageal_cancer"=  esophageal_cancer_leaveoneout_results,
                          "gastric_cancer"= gastric_cancer_leaveoneout_results,
                          "liver_cancer"= liver_cancer_leaveoneout_results,
                          "pancreatic_cancer"= pancreatic_cancer_leaveoneout_results,
                          "rectal_cancer"= rectal_cancer_leaveoneout_results,
                          "small_intestine_cancer"= small_intestine_cancer_leaveoneout_results)

write.xlsx(list_of_datasets6, file = "mr_output/met-c-859/leaveoneout_gi_system2.xlsx")
